# ‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Cookie-based —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ - –ò—Ç–æ–≥–∏

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω manifest.json
**–§–∞–π–ª:** `/manifest.json`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```json
{
  "permissions": ["storage", "sidePanel", "cookies"],
  "host_permissions": [
    "https://task-man-rf22.onrender.com/*"
  ]
}
```

### 2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω background.js
**–§–∞–π–ª:** `/background.js`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –§—É–Ω–∫—Ü–∏—è `syncCookieToStorage()` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è cookie ‚Üí chrome.storage
- Listener `chrome.cookies.onChanged` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π cookies
- Listener `chrome.storage.onChanged` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π storage
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ/—É—Å—Ç–∞–Ω–æ–≤–∫–µ/–æ—Ç–∫—Ä—ã—Ç–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –≤–µ–± ‚Üí cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ storage
- –ü—Ä–∏ logout –≤ –≤–µ–± ‚Üí cookie –∏ storage –æ—á–∏—â–∞—é—Ç—Å—è
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å –≤–µ–±-–≤–µ—Ä—Å–∏–µ–π

### 3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω scripts/auth.js
**–§–∞–π–ª:** `/scripts/auth.js`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –§—É–Ω–∫—Ü–∏—è `getTokenFromCookie()` - —á—Ç–µ–Ω–∏–µ cookie —á–µ—Ä–µ–∑ Chrome API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ cookie –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (fallback –µ—Å–ª–∏ –Ω–µ—Ç –≤ storage)
- Listener –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è chrome.storage –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ token –∏ user –º–µ–∂–¥—É storage –∏ cookie

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ storage
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≤–µ–±-–≤–µ—Ä—Å–∏–µ–π (localStorage) –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º (chrome.storage)

### 4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω server/index.js (Backend)
**–§–∞–π–ª:** `/server/index.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```javascript
// CORS - –≤–∫–ª—é—á–µ–Ω—ã credentials
app.use(cors({
  origin: true,
  credentials: true,  // ‚Üê –±—ã–ª–æ false
  allowedHeaders: ['Content-Type', 'Authorization']
}));

// Cookie settings
function attachSessionCookie(res, token) {
  res.cookie(SESSION_COOKIE, token, {
    httpOnly: true,
    sameSite: 'none',  // ‚Üê –±—ã–ª–æ 'lax'
    secure: true,       // ‚Üê –±—ã–ª–æ COOKIE_SECURE
    maxAge: SESSION_TTL || undefined
  });
}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:**
- `credentials: true` - –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å/–ø–æ–ª—É—á–∞—Ç—å cookies
- `sameSite: 'none'` - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç cross-origin cookies (–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
- `secure: true` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è sameSite='none', —Ç—Ä–µ–±—É–µ—Ç HTTPS

### 5. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
**–§–∞–π–ª—ã:**
- `COOKIE_SYNC_GUIDE.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `DEPLOY_COOKIE_SYNC.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –≤–µ–±-–≤–µ—Ä—Å–∏—é
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí https://task-man-rf22.onrender.com/auth
2. –í–≤–æ–¥–∏—Ç email/password ‚Üí POST /api/auth/login
3. Backend ‚Üí —Å–æ–∑–¥–∞–µ—Ç session token
4. Backend ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie (todo_token)
5. Backend ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON { token, user }
6. –í–µ–± ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
7. Background.js (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ) ‚Üí —Å–ª—É—à–∞–µ—Ç chrome.cookies.onChanged
8. Background.js ‚Üí –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—É—é cookie
9. Background.js ‚Üí —á–∏—Ç–∞–µ—Ç cookie —á–µ—Ä–µ–∑ chrome.cookies.get()
10. Background.js ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ chrome.storage.local
11. auth.js (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ) ‚Üí —Å–ª—É—à–∞–µ—Ç chrome.storage.onChanged
12. auth.js ‚Üí –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π token
13. auth.js ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç emit() ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç UI
14. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–æ ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—Ö–æ–¥ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
2. –í–≤–æ–¥–∏—Ç email/password ‚Üí POST /api/auth/login
3. Backend ‚Üí —Å–æ–∑–¥–∞–µ—Ç session token
4. Backend ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie (todo_token)
5. Backend ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON { token, user }
6. auth.js ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç token –≤ chrome.storage.local
7. Background.js ‚Üí –ù–ï –Ω—É–∂–µ–Ω (cookie —É–∂–µ –µ—Å—Ç—å)
8. –í–µ–±-–≤–µ—Ä—Å–∏—è ‚Üí –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∏—Ç–∞–µ—Ç cookie ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
2. background.js ‚Üí syncCookieToStorage() –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
3. background.js ‚Üí —á–∏—Ç–∞–µ—Ç cookie —á–µ—Ä–µ–∑ chrome.cookies.get()
4. background.js ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ chrome.storage.local (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
5. auth.js ‚Üí loadFromStorage()
6. auth.js ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç token –≤ chrome.storage.local
7. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–æ ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: Logout
```
–ò–∑ –≤–µ–±-–≤–µ—Ä—Å–∏–∏:
1. POST /api/auth/logout ‚Üí —É–¥–∞–ª—è–µ—Ç session –Ω–∞ backend
2. Backend ‚Üí —É–¥–∞–ª—è–µ—Ç cookie (expires: new Date(0))
3. Background.js ‚Üí –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ cookie
4. Background.js ‚Üí –æ—á–∏—â–∞–µ—Ç chrome.storage.local
5. auth.js ‚Üí —Å–ª—É—à–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è storage
6. auth.js ‚Üí –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ token
7. auth.js ‚Üí emit() ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞ ‚úÖ

–ò–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
1. POST /api/auth/logout
2. auth.js ‚Üí clearSession()
3. auth.js ‚Üí —É–¥–∞–ª—è–µ—Ç –∏–∑ chrome.storage.local
4. Background.js ‚Üí —Å–ª—É—à–∞–µ—Ç storage.onChanged
5. Background.js ‚Üí —É–¥–∞–ª—è–µ—Ç cookie
6. –í–µ–±-–≤–µ—Ä—Å–∏—è ‚Üí –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω–∞ ‚úÖ
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è production

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω!

Cookie —Å `sameSite='none'` –∏ `secure=true` —Ä–∞–±–æ—Ç–∞—é—Ç **–¢–û–õ–¨–ö–û** –ø–æ HTTPS.

### Environment variables –Ω–∞ Render.com:
```bash
NODE_ENV=production
COOKIE_SECURE=true
```

–ë–µ–∑ —ç—Ç–æ–≥–æ cookies –ù–ï –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ production!

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

#### Backend (Render.com):
- [ ] –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω
- [ ] HTTPS –∞–∫—Ç–∏–≤–µ–Ω
- [ ] Environment variables —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] `/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200

#### –í–µ–±-–≤–µ—Ä—Å–∏—è:
- [ ] –í—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Cookie `todo_token` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- [ ] Cookie –∏–º–µ–µ—Ç: HttpOnly=true, Secure=true, SameSite=None
- [ ] –ó–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- [ ] Logout –æ—á–∏—â–∞–µ—Ç cookie

#### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤ Chrome
- [ ] Permissions: cookies, storage, sidePanel
- [ ] host_permissions: https://task-man-rf22.onrender.com/*
- [ ] Background service worker –∞–∫—Ç–∏–≤–µ–Ω

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–µ–± ‚Üí —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ:
- [ ] –í—Ö–æ–¥ –≤ –≤–µ–±
- [ ] –û—Ç–∫—Ä—ã—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–æ
- [ ] –ó–∞–¥–∞—á–∏ –∏–∑ –≤–µ–± –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí –≤–µ–±:
- [ ] –í—Ö–æ–¥ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- [ ] –û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–≤–µ—Ä—Å–∏—é
- [ ] –í–µ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–∞
- [ ] –ó–∞–¥–∞—á–∏ –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –≤–µ–±

#### Logout —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
- [ ] Logout –≤ –≤–µ–± ‚Üí —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω–æ
- [ ] Logout –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ ‚Üí –≤–µ–± —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω–∞

---

## –û—Ç–ª–∞–¥–∫–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

#### –í –∫–æ–Ω—Å–æ–ª–∏ –≤–µ–±-–≤–µ—Ä—Å–∏–∏:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookie
document.cookie

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage
console.log({
  token: localStorage.getItem('todoAuthToken'),
  user: localStorage.getItem('todoAuthUser')
});
```

#### –í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å chrome.storage
chrome.storage.local.get(['todoAuthToken', 'todoAuthUser'], (result) => {
  console.log('Storage:', result);
});

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookie
chrome.cookies.get({
  url: 'https://task-man-rf22.onrender.com',
  name: 'todo_token'
}, (cookie) => {
  console.log('Cookie:', cookie);
});

// –í—Å–µ cookies –¥–ª—è –¥–æ–º–µ–Ω–∞
chrome.cookies.getAll({
  domain: 'task-man-rf22.onrender.com'
}, (cookies) => {
  console.log('All cookies:', cookies);
});
```

#### –õ–æ–≥–∏ background.js:
1. chrome://extensions
2. –ù–∞–π—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ "GoFimaGo!"
3. –ù–∞–∂–∞—Ç—å "service worker" –∏–ª–∏ "background page"
4. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
   - `üîÑ Background: Syncing cookie to storage...`
   - `‚úÖ Background: Found cookie, saving to storage`
   - `üç™ Background: Cookie changed`

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Cookie –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º—ã:** –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ cookie –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–ü—Ä–∏—á–∏–Ω—ã:**
- Backend –Ω–µ –ø–æ HTTPS
- CORS: `credentials: false`
- Cookie: `secure: false` –ø—Ä–∏ `sameSite='none'`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTTPS –Ω–∞ Render.com
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `credentials: true` –≤ server/index.js
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `secure: true` –≤ attachSessionCookie()

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ –≤–∏–¥–∏—Ç cookie
**–°–∏–º–ø—Ç–æ–º—ã:** Cookie –µ—Å—Ç—å, –Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ—Ç permission "cookies" –≤ manifest.json
- –ù–µ—Ç host_permissions
- Background service worker –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ manifest.json
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (chrome://extensions ‚Üí ‚ü≥)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ service worker (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–µ–ª–µ–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
**–°–∏–º–ø—Ç–æ–º—ã:** –†–∞–±–æ—Ç–∞–µ—Ç –≤–µ–± ‚Üí —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –Ω–æ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç

**–ü—Ä–∏—á–∏–Ω—ã:**
- background.js –Ω–µ —Å–ª—É—à–∞–µ—Ç chrome.storage.onChanged
- auth.js –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç persistToStorage()

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ listeners –≤ background.js (—Å—Ç—Ä–æ–∫–∞ ~60)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ auth.js –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ storage.onChanged (—Å—Ç—Ä–æ–∫–∞ ~160)
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 4: CORS –æ—à–∏–±–∫–∞
**–°–∏–º–ø—Ç–æ–º—ã:** `Access to fetch has been blocked by CORS policy`

**–ü—Ä–∏—á–∏–Ω—ã:**
- `credentials: false` –≤ CORS
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π origin

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// server/index.js
app.use(cors({
  origin: true,  // –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–º–µ–Ω
  credentials: true  // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
}));
```

---

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

‚úÖ `/manifest.json` - –¥–æ–±–∞–≤–ª–µ–Ω—ã permissions –∏ host_permissions
‚úÖ `/background.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è cookies
‚úÖ `/scripts/auth.js` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å cookies –∏ live-sync
‚úÖ `/server/index.js` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã CORS –∏ cookie settings

üìÑ `/COOKIE_SYNC_GUIDE.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
üìÑ `/DEPLOY_COOKIE_SYNC.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é
üìÑ `/COOKIE_SYNC_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–µ–ø–ª–æ–π backend:**
   ```bash
   git add .
   git commit -m "feat: cookie-based sync for web and extension"
   git push origin main
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Render.com:**
   - Environment ‚Üí Add Variable
   - `NODE_ENV` = `production`
   - `COOKIE_SECURE` = `true`

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
   - chrome://extensions
   - Reload extension
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –≤–µ–± ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
   - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ–±
   - Logout ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:**
- HttpOnly cookies - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
- Secure flag - –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–ª—å–∫–æ –ø–æ HTTPS
- SameSite=None - –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π cross-origin –¥–æ—Å—Ç—É–ø
- CORS credentials - —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
- Cookie –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ JavaScript (HttpOnly)
- Token –≤ JSON –æ—Ç–≤–µ—Ç–µ - —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- localStorage –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–µ–±-–≤–µ—Ä—Å–∏–∏
- chrome.storage –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- Token –≤—Å–µ –µ—â–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ JSON –æ—Ç–≤–µ—Ç–µ
- –í–µ–±-–≤–µ—Ä—Å–∏—è –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –≤–µ–±-–≤–µ—Ä—Å–∏–∏
- –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ù–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- Cookie sync –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- Listeners –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç UI
- Background service worker —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead (<1ms –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é)

---

## –ò—Ç–æ–≥–∏

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–µ–± –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π login –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤ –≤–µ–±
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout –≤ –æ–±–æ–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö
- Live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ storage listeners
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ HTTP-only cookies

### üéØ –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ —Ü–µ–ª–∏:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ –≤–µ–± ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –≤ –≤–µ–±
- ‚úÖ Logout —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (HttpOnly, Secure, SameSite)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è production)

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ: 4
- –§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: 3 (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ~300
- –°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ: ~20
- –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: 0 (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—Ç–∏–≤–Ω—ã–µ API)

---

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** Claude Sonnet 4.5  
**–î–∞—Ç–∞:** 2025-09-30  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é
