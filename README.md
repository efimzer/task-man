# Todo Sync & Mobile Access

Этот репозиторий теперь содержит два варианта интерфейса списка дел:
- расширение Chrome (side panel);
- веб-приложение, которое можно открыть на телефоне и установить как PWA.

Добавлена синхронизация через простой REST-сервер, поэтому задачи остаются общими между расширением и мобильной версией.

## Требования
- Node.js 18+
- npm 9+

## Установка зависимостей
```bash
npm install
```

## Настройка синхронизации
1. Отредактируйте файл `scripts/sync-config.js` и задайте свои параметры:
   ```js
   export const syncConfig = {
     enabled: true,
     baseUrl: 'https://example.com', // адрес вашего sync-сервера
     userId: 'my-user',              // любой уникальный идентификатор
     authToken: 'секрет-токен',      // необязательно, но рекомендуется
     pullOnStartup: true,
     pushDebounceMs: 1500
   };
   ```
2. Запустите сервер синхронизации локально:
   ```bash
   npm run dev:server
   ```
   По умолчанию сервер слушает порт `8787` и хранит состояние в файле `server/storage.json`.
3. (Опционально) Укажите переменные окружения, если размещаете сервер в облаке:
   - `PORT` — внешний порт;
   - `TODO_SYNC_DB` — путь к JSON-файлу с состоянием;
   - `TODO_SYNC_TOKEN` — токен, который сервер будет ожидать в заголовке `Authorization: Bearer ...`.
4. Если вы используете токен, пропишите его же в `syncConfig.authToken`.

Когда синхронизация включена, любое изменение списка автоматически отправляется на сервер, а при старте приложение подтягивает последнюю версию. Веб-версия и расширение используют единый API и единое состояние.

## Запуск расширения Chrome
1. Соберите или настройте синхронизацию (см. выше).
2. В Chrome откройте `chrome://extensions` и включите режим разработчика.
3. Нажмите «Загрузить распакованное расширение» и выберите директорию репозитория.
4. Откройте боковую панель Chrome и проверьте, что задачи синхронизируются.

## Веб-версия / мобильный доступ
1. Запустите любой статический сервер, указывающий корень репозитория, например:
   ```bash
   npx http-server . -p 4173
   ```
   или опубликуйте содержимое на Vercel/Netlify.
2. Откройте в браузере адрес `http://localhost:4173/web/` (при размещении на продакшн-домене — `/web/`).
3. На телефоне нажмите «Добавить на главный экран». Благодаря `manifest.webmanifest` и сервис-воркеру `web/sw.js` веб-приложение устанавливается как PWA и работает в полноэкранном режиме.

### Замечания
- Для корректной работы синхронизации и мобильной версии сервер должен быть доступен из сети телефона.
- Если вы меняете `sync-config.js`, обновите PWA (меню браузера → «Обновить приложение»), потому что файл кэшируется сервис-воркером.
- Файл `server/storage.json` можно резервировать или заменить на любую БД по вашему желанию — главное, чтобы API сохранял и отдавал объект состояния целиком.

## Структура
- `scripts/` — общий код интерфейса и синхронизации.
- `web/` — веб/PWA-оболочка.
- `server/` — express-сервер для хранения состояния.
- `icons/` — набор иконок для расширения и PWA.

Если нужно расширить API (например, добавить несколько пользователей или историю изменений), начните с `server/index.js` и `scripts/sync.js`.
