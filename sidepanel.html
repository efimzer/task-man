<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Todo</title>
    <link rel="stylesheet" href="styles/theme-light.css" />
    <link rel="stylesheet" href="styles/theme-dark.css" />
    <link rel="stylesheet" href="styles/app.css" />
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon_io/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon_io/favicon-16x16.png" />
    <link rel="shortcut icon" href="icons/favicon_io/favicon.ico" />
  </head>
  <body>
    <div class="app-shell">
      <div id="pullToRefresh" class="pull-refresh" aria-hidden="true">
        <div class="pull-refresh-indicator">
          <span class="pull-refresh-spinner"></span>
          <span class="pull-refresh-label" id="pullToRefreshLabel">Потяните, чтобы синхронизировать</span>
        </div>
      </div>
      <section id="screenFolders" class="screen screen-folders">
        <header class="screen-header">
          <h1 class="screen-title">To Do</h1>
          <button class="icon-button primary app-menu-button" aria-label="Меню приложения" type="button">⋮</button>
        </header>
        <ul id="folderList" class="card-list" role="list"></ul>
      </section>

      <section id="screenTasks" class="screen screen-tasks" aria-live="polite">
        <header class="tasks-header">
          <button id="backToFolders" class="back-button" aria-label="Назад к списку папок"><span class="back-icon"></span></button>
          <div class="tasks-heading">
            <h2 id="tasksHeaderTitle" class="tasks-title">Задачи</h2>
          </div>
          <button id="weekMenuButton" class="icon-button primary app-menu-button week-menu-button hidden" type="button" aria-label="Меню недели">⋮</button>
        </header>
        <div id="weekToolbar" class="week-toolbar hidden" aria-label="Навигация по неделе">
          <button id="weekPrevButton" class="week-nav-button" type="button" aria-label="Предыдущая неделя">‹</button>
          <div class="week-range">
            <span id="weekRangeLabel" class="week-range-label"></span>
            <button id="weekTodayButton" class="week-today-button" type="button">Сегодня</button>
          </div>
          <button id="weekNextButton" class="week-nav-button" type="button" aria-label="Следующая неделя">›</button>
        </div>
        <div class="tasks-scroll">
          <ul id="taskList" class="task-list" role="list"></ul>
          <div id="weekView" class="week-view hidden">
            <div id="weekGrid" class="week-grid"></div>
          </div>
          <div id="emptyState" class="empty-state">
            <p class="empty-message">Задач пока нет</p>
          </div>
        </div>
      </section>

      <section id="screenSettings" class="screen screen-settings hidden">
        <header class="tasks-header">
          <button id="backToFoldersFromSettings" class="back-button" aria-label="Назад к списку папок"><span class="back-icon"></span></button>
          <div class="tasks-heading">
            <h2 class="tasks-title">Настройки</h2>
          </div>
        </header>
        <div class="tasks-scroll">
          <div class="settings-container">
            <div class="settings-group">
              <h3 class="settings-group-title">Внешний вид</h3>
              
              <div class="settings-item">
                <div class="settings-item-content">
                  <span class="settings-item-label">Автоматический выбор темы</span>
                  <span class="settings-item-description">Использовать настройки системы</span>
                </div>
                <label class="settings-toggle">
                  <input type="checkbox" id="autoThemeToggle" checked />
                  <span class="settings-toggle-slider"></span>
                </label>
              </div>

              <div class="settings-item">
                <div class="settings-item-content">
                  <span class="settings-item-label">Тёмная тема</span>
                  <span class="settings-item-description">Переключить цветовую схему</span>
                </div>
                <label class="settings-toggle">
                  <input type="checkbox" id="darkModeToggle" />
                  <span class="settings-toggle-slider"></span>
                </label>
              </div>

              <div class="settings-item">
                <div class="settings-item-content">
                  <span class="settings-item-label">Счётчик задач</span>
                  <span class="settings-item-description">Показывать количество задач</span>
                </div>
                <label class="settings-toggle">
                  <input type="checkbox" id="showCounterToggle" checked />
                  <span class="settings-toggle-slider"></span>
                </label>
              </div>

              <div class="settings-item">
                <div class="settings-item-content">
                  <span class="settings-item-label">Показывать архив</span>
                  <span class="settings-item-description">Папка "Архив" на главной</span>
                </div>
                <label class="settings-toggle">
                  <input type="checkbox" id="showArchiveToggle" checked />
                  <span class="settings-toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="settings-group">
              <h3 class="settings-group-title">Данные</h3>
              
              <button type="button" id="syncNowButton" class="settings-button settings-button-sync">
                <div class="settings-button-content">
                  <span class="settings-button-label" id="syncStatusLabel">Синхронизация</span>
                  <span class="settings-button-description">Принудительно обновить состояние</span>
                </div>
              </button>

              <button type="button" id="clearArchiveButton" class="settings-button">
                <div class="settings-button-content">
                  <span class="settings-button-label">Очистить архив</span>
                  <span class="settings-button-description">Удалить все завершённые задачи</span>
                </div>
              </button>
            </div>

            <div class="settings-group">
              <h3 class="settings-group-title">Аккаунт</h3>
              
              <button type="button" id="changePasswordButton" class="settings-button">
                <div class="settings-button-content">
                  <span class="settings-button-label">Сменить пароль</span>
                  <span class="settings-button-description">Изменить пароль для входа</span>
                </div>
              </button>

              <button type="button" id="logoutButton" class="settings-button settings-button-danger">
                <div class="settings-button-content">
                  <span class="settings-button-label">Выйти</span>
                  <span class="settings-button-description">Выйти из аккаунта</span>
                </div>
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <template id="folderTemplate">
      <li class="entry-card folder-item" data-folder-id="" tabindex="0" role="button">
        <div class="folder-content">
          <span class="folder-name"></span>
          <span class="folder-count badge"></span>
        </div>
        <button class="folder-menu-button" aria-label="Дополнительные действия" type="button">⋮</button>
      </li>
    </template>

    <template id="taskTemplate">
      <li class="entry-card task-item" data-task-id="" draggable="true">
        <span class="drag-handle" role="presentation" aria-hidden="true">⋮⋮</span>
        <label class="checkbox">
          <input type="checkbox" aria-label="Отметить задачу выполненной" />
          <span class="checkbox-visual"></span>
        </label>
        <div class="task-body">
          <span class="task-title" tabindex="0"></span>
          <span class="task-folder-label"></span>
        </div>
        <button class="icon-button primary task-remove" aria-label="Удалить задачу из архива" type="button"><span class="icon-plus icon-plus-rotate">＋</span></button>
      </li>
    </template>

    <div id="folderMenu" class="folder-menu hidden" role="menu">
      <button type="button" class="folder-menu-item view-toggle" data-action="view-list" role="menuitemradio" aria-checked="true">List view</button>
      <button type="button" class="folder-menu-item view-toggle" data-action="view-week" role="menuitemradio" aria-checked="false">Week view</button>
      <div class="folder-menu-divider" role="separator"></div>
      <button type="button" class="folder-menu-item" data-action="rename">Переименовать</button>
      <button type="button" class="folder-menu-item" data-action="delete">Удалить</button>
    </div>

    <div id="appMenu" class="folder-menu app-menu hidden" role="menu">
      <button type="button" id="settingsAction" class="folder-menu-item">Настройки</button>
      <button type="button" id="logoutAction" class="folder-menu-item">Выйти</button>
    </div>

    <div id="weekMenu" class="folder-menu week-menu hidden" role="menu">
      <button type="button" class="folder-menu-item" data-action="toggle-completed" role="menuitemcheckbox" aria-checked="false">Отображать выполненные</button>
      <button type="button" class="folder-menu-item" data-action="carryover">Перенести оставшиеся задачи</button>
    </div>

    <div id="modalBackdrop" class="modal-backdrop hidden"></div>
    <section id="folderModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="folderModalTitle">
      <div class="modal-card">
        <header class="modal-header">
          <h2 id="folderModalTitle" class="modal-title">Новая папка</h2>
        </header>
        <form id="folderModalForm" class="modal-body" autocomplete="off">
          <label class="field">
            <input id="folderModalInput" type="text" class="input" maxlength="100" />
          </label>
          <footer class="modal-actions">
            <button type="button" id="folderModalCancel" class="ghost-button">Отмена</button>
            <button type="submit" class="primary-button">Сохранить</button>
          </footer>
        </form>
      </div>
    </section>

    <button id="floatingActionButton" class="fab" type="button" aria-label="Добавить">＋</button>

    <div id="authOverlay" class="auth-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="auth-card">
        <h2 id="authTitle" class="auth-heading">Вход</h2>
        <form id="authForm" class="auth-form" autocomplete="off">
          <label class="field">
            <span class="field-label">Email</span>
            <input id="authEmail" type="email" class="input" autocomplete="email" required />
          </label>
          <label class="field">
            <span class="field-label">Пароль</span>
            <input id="authPassword" type="password" class="input" autocomplete="current-password" required minlength="6" />
          </label>
          <p id="authError" class="auth-inline-error" role="alert"></p>
          <div class="auth-actions">
            <button id="authSubmit" type="submit" class="primary-button">Войти</button>
            <button id="authToggleMode" type="button" class="ghost-button">Регистрация</button>
          </div>
        </form>
      </div>
    </div>

    <script type="module" src="scripts/sidepanel.js"></script>
  </body>
</html>
