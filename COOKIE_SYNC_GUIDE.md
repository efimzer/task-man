# üç™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Cookies

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **HTTP-only cookies** –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–µ–±-–≤–µ—Ä—Å–∏–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º Chrome.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. **manifest.json**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã permissions: `"cookies"`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã host_permissions: `"https://task-man-rf22.onrender.com/*"`

### 2. **background.js**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è cookies ‚Üî chrome.storage
- ‚úÖ Listener –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è cookies
- ‚úÖ Listener –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è chrome.storage

### 3. **scripts/auth.js**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getTokenFromCookie()`
- ‚úÖ –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è cookie –µ—Å–ª–∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞ –≤ storage
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ chrome.storage –¥–ª—è live-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### 4. **server/index.js (Backend)**
- ‚úÖ CORS: `credentials: true` (–≤–º–µ—Å—Ç–æ false)
- ‚úÖ Cookie: `sameSite: 'none'` (–≤–º–µ—Å—Ç–æ 'lax')
- ‚úÖ Cookie: `secure: true` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è sameSite='none')

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–µ–±-–≤–µ—Ä—Å–∏—è:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è
2. Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie `todo_token`
3. Cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º
4. Token —Ç–∞–∫–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ JSON (–¥–ª—è localStorage)

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ Chrome:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è (–∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
2. `background.js` —á–∏—Ç–∞–µ—Ç cookie —á–µ—Ä–µ–∑ `chrome.cookies.get()`
3. Cookie —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `chrome.storage.local`
4. `auth.js` –∑–∞–≥—Ä—É–∂–∞–µ—Ç token –∏–∑ storage
5. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ cookie ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è storage

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:
```
–í–µ–± –ª–æ–≥–∏–Ω ‚Üí Cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
          ‚Üì
Background.js —Å–ª—É—à–∞–µ—Ç ‚Üí –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–æ–≤–∞—è cookie
          ‚Üì
chrome.storage.local –æ–±–Ω–æ–≤–ª–µ–Ω ‚Üí token —Å–æ—Ö—Ä–∞–Ω–µ–Ω
          ‚Üì
auth.js –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ storage ‚Üí emit() –≤—ã–∑–≤–∞–Ω
          ‚Üì
UI –æ–±–Ω–æ–≤–ª–µ–Ω ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—à–µ–ª
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è production

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –î–ª—è production –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω—É–∂–µ–Ω HTTPS!

Cookie —Å `sameSite='none'` –∏ `secure=true` —Ä–∞–±–æ—Ç–∞—é—Ç **–¢–û–õ–¨–ö–û** –ø–æ HTTPS.

### Environment variables:

```bash
# .env –∏–ª–∏ environment –Ω–∞ Render
NODE_ENV=production
COOKIE_SECURE=true
PORT=8787
```

### –ù–∞ Render.com:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–∏—Å–∞
2. Environment ‚Üí Add Environment Variable
3. –î–æ–±–∞–≤—å—Ç–µ:
   - `NODE_ENV` = `production`
   - `COOKIE_SECURE` = `true`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–≤–µ—Ä—Å–∏–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://task-man-rf22.onrender.com/auth
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Cookies
4. –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å cookie `todo_token` —Å:
   - ‚úÖ HttpOnly: true
   - ‚úÖ Secure: true
   - ‚úÖ SameSite: None

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ Chrome (chrome://extensions)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
3. –î–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–π—Ç–∏ (–µ—Å–ª–∏ –±—ã–ª–∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –≤ –≤–µ–±)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å:
   ```
   üç™ Background: Cookie changed
   ‚úÖ Background: Found cookie, saving to storage
   üîë AuthStore: loaded from storage
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
1. –í–æ–π–¥–∏—Ç–µ –≤ **–≤–µ–±-–≤–µ—Ä—Å–∏—é**
2. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ **—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ**
4. –ó–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–ø–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

## –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookie –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ –≤–µ–±-–≤–µ—Ä—Å–∏–∏
   document.cookie
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ chrome.storage:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
   chrome.storage.local.get(['todoAuthToken'], (result) => {
     console.log('Token:', result.todoAuthToken);
   });
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ cookie –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
   chrome.cookies.get({
     url: 'https://task-man-rf22.onrender.com',
     name: 'todo_token'
   }, (cookie) => {
     console.log('Cookie:', cookie);
   });
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ background.js:**
   - chrome://extensions ‚Üí –≤–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí "service worker"
   - –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

‚ùå **Cookie –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω —Å HTTPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS: `credentials: true`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookie: `secure: true`, `sameSite: 'none'`

‚ùå **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–µ –≤–∏–¥–∏—Ç cookie:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `host_permissions` –≤ manifest.json
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è manifest
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–º–µ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç

‚ùå **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ background.js –∑–∞–≥—Ä—É–∂–µ–Ω (service worker –∞–∫—Ç–∏–≤–µ–Ω)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ listeners –≤ background.js
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ auth.js –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ storage.onChanged

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ (–±–µ–∑ cookies):

1. –í `server/index.js`:
   ```javascript
   credentials: false,  // –±—ã–ª–æ: true
   sameSite: 'lax',     // –±—ã–ª–æ: 'none'
   ```

2. –í `manifest.json`:
   ```json
   // –£–¥–∞–ª–∏—Ç—å: "cookies" –∏–∑ permissions
   // –£–¥–∞–ª–∏—Ç—å: host_permissions
   ```

3. –û—Ç–∫–∞—Ç–∏—Ç—å `background.js` –∏ `scripts/auth.js`

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. Backend –ª–æ–≥–∏ (–Ω–∞ Render.com ‚Üí Logs)
2. Browser console (–≤–µ–±-–≤–µ—Ä—Å–∏—è)
3. Extension console (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ ‚Üí DevTools)
4. Background service worker (chrome://extensions)

---

**–ê–≤—Ç–æ—Ä:** Claude  
**–î–∞—Ç–∞:** 2025-09-30  
**–í–µ—Ä—Å–∏—è:** 1.0.0
